<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    {% if meta-description %}<meta name="description" content="{{meta-description}}">{% endif %}
    <link rel="icon" href="/favicon.ico">

    <title>{{title}}</title>
    {% if google-site-verification %}<meta name="google-site-verification" content="{{google-site-verification}}" />{% endif %}
    <script src='https://www.google.com/recaptcha/api.js'></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
    {{ad-code-for-thread-in-head|safe}}
</head>



<body>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/css/bootstrap-dialog.min.css">
<link rel="stylesheet" href="/blueimp-gallery/css/blueimp-gallery.min.css">
<link rel="stylesheet" href="/bootstrap-image-gallery/css/bootstrap-image-gallery.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/emojione/2.1.0/assets/css/emojione.min.css"/>
<link rel="stylesheet" href="/emojionearea/css/emojionearea.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/github.min.css">
{% style "/css/screen.css" %}

<div id="navbar"></div>
<div id="app">
    <div class="container">
        <span class="glyphicon glyphicon-refresh spinning loading-page"></span>
    </div>
</div>
<div id="navbar-bottom"></div>

<!-- The Bootstrap Image Gallery lightbox, should be a child element of the document body -->
<div id="blueimp-gallery" class="blueimp-gallery">
    <!-- The container for the modal slides -->
    <div class="slides"></div>
    <!-- Controls for the borderless lightbox -->
    <h3 class="title"></h3>
    <a class="prev">‹</a>
    <a class="next">›</a>
    <a class="close updated">×</a>
    <a class="play-pause"></a>
    <!-- <ol class="indicator"></ol> -->
    <!-- The modal dialog, which will be used to wrap the lightbox content -->
    <div class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" aria-hidden="true">&times;</button>
                    <h4 class="modal-title"></h4>
                </div>
                <div class="modal-body next"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left prev">
                        <i class="glyphicon glyphicon-chevron-left"></i>
                        Previous
                    </button>
                    <button type="button" class="btn btn-primary next">
                        Next
                        <i class="glyphicon glyphicon-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<!-- <script src="http://getbootstrap.com/assets/js/ie10-viewport-bug-workaround.js"></script> -->
<script src="https://maxcdn.bootstrapcdn.com/js/ie10-viewport-bug-workaround.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/js/bootstrap-dialog.min.js"></script>
<script src="/blueimp-gallery/js/jquery.blueimp-gallery.min.js"></script>
<script src="/bootstrap-image-gallery/js/bootstrap-image-gallery.js"></script>
<script src="/jquery/jquery.hoverIntent.js"></script>
<script src="/jquery/jquery.qrcode.min.js"></script>
<script src="//cdn.jsdelivr.net/emojione/2.1.0/lib/js/emojione.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/js-cookie/2.0.4/js.cookie.min.js"></script>
<script src="/emojionearea/js/emojionearea.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/languages/clojure.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/languages/clojure-repl.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/languages/go.min.js"></script>
{% style "/css/screen.css" %}

<script type="text/javascript">
    var context = "{{servlet-context}}";

    window.mobileCheck = function() {
        var check = false;
        (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check = true})(navigator.userAgent||navigator.vendor||window.opera);
        return check;
    }
    window.mobileAndTabletCheck = function() {
        var check = false;
        (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check = true})(navigator.userAgent||navigator.vendor||window.opera);
        return check;
    }
</script>
{% script "/js/app.js" %}

<script>
    // TODO: Rewrite the following code in ClojureScript.
	$(document).ready(function() {
		var currentMousePos = { x: -1, y: -1 };
        var timer;
        var fadeInBuffer = false;
        $(document).mousemove(function (event) {
            currentMousePos.x = event.pageX;
            currentMousePos.y = event.pageY;
            if (!fadeInBuffer) {
                if (timer) {
                    clearTimeout(timer);
                    timer = 0;
                }
            } else {
                fadeInBuffer = false;
            }

            timer = setTimeout(function () {
                fadeInBuffer = true;
                if ($('.slide-content').length > 0)
                    return;
                var keepTooltips = false;
                $($(":hover").get().reverse()).each(function (index, element) {
                    if ($(element).hasClass('anchor')) {
                        keepTooltips = true;
                        return false;
                    } else if ($(element).hasClass('tooltip-inner')) {
                        // $(element).parent().nextAll('.tooltip').remove();
                        var removeFlag = false;
                        $('.tooltip').each(function (index, elementInnerLoop) {
                            if (removeFlag)
                                $(elementInnerLoop).remove();
                            if ($(element).parent()[0] == elementInnerLoop)
                                removeFlag = true;
                        });
                        keepTooltips = true;
                        return false;
                    }
                });

                if (!keepTooltips) {
                    $('.anchor').tooltip('hide');
                    $('.tooltip').remove();
                }
            }, 250)
        });

        // For attachment
        $(document).on('change', '.btn-file :file', function() {
            var file = $(this).get(0).files[0];
            var preview = $(this).parent().children('img');
            var preview_label = $(this).parent().children('span');
            var numFiles = $(this).get(0).files ? $(this).get(0).files.length : 1;
            var label = $(this).val().replace(/\\/g, '/').replace(/.*\//, '');
            if ($(this).val() && file.type.match('image.*')) {
                var fileRdr = new FileReader();
                fileRdr.onload = function() {
                    preview.attr('src', fileRdr.result);
                }
                fileRdr.readAsDataURL(file);
                preview_label.html("<br />" + decodeURIComponent(escape(label)) + ' (' + Math.round($(this).get(0).files[0].size / 1024) + 'KB)').css('color', 'black');
            } else if ($(this).val()) {
                preview.attr('src', "");
                preview_label.html(escape(decodeURIComponent(label))).css('color', 'black');
            } else {
                preview.attr('src', "");
                preview_label.html('添付ファイル').css('color', 'gray');
            }
        });

        $('html, body')
            .on("dragenter", function(event) {
                if (event.originalEvent.dataTransfer.types) {
                    for (var i = 0; i < event.originalEvent.dataTransfer.types.length; i++) {
                        if (event.originalEvent.dataTransfer.types[i] == "Files") {
                            event.preventDefault();
                            return false;
                        }
                    }
                }
                return true;
            })
            .on("dragover", function(event) {
                if (event.originalEvent.dataTransfer.types) {
                    for (var i = 0; i < event.originalEvent.dataTransfer.types.length; i++) {
                        if (event.originalEvent.dataTransfer.types[i] == "Files") {
                            event.preventDefault();
                            return false;
                        }
                    }
                }
                return true;
            })
            .on("drop", function(event) {
                if (event.originalEvent.dataTransfer.files.length <= 0)
                    return true;
                event.stopPropagation();
                event.preventDefault();
                ju.core.show_post_form_with_files(event.originalEvent.dataTransfer.files);
                return false;
            });
    });

    // Post Form
    function switchTabsForPostForm (newActiveTab) {
        var prevActiveTabID = $("#post-form-tabs > li.active").attr('id');
        if ($(newActiveTab).hasClass("active"))
            return;
        $("#post-form-tabs > li").removeClass('active');
        $(newActiveTab).addClass("active");

        if (prevActiveTabID == 'post-form-emoji-tab') {
            $("#post-form .input-group").hide();
            $("#post-form .emojionearea").hide();
        } else if (prevActiveTabID == 'post-form-edit-tab') {
            $("#post-form .input-group").hide();
            $("#post-form textarea#body").hide();
            $("#post-form .emojionearea").hide();
        } else if (prevActiveTabID == 'post-form-preview-tab') {
            $("#post-preview").hide();
        }

        if ($(newActiveTab).attr('id') == 'post-form-emoji-tab') {
            $("#post-form .input-group").show();
            $("#post-form textarea#body").emojioneArea({
                // options
                autoHideFilters: false,
                hideSource: true,
                // shortnames: true,
                useSprite: false,
            })[0].emojioneArea.setText(ju.core.convert_string_for_emojione($("#post-form textarea").val()));
            $("#post-form .emojionearea").show();
        } else if ($(newActiveTab).attr('id') == 'post-form-edit-tab') {
            $("#post-form .input-group").show();
            $("#post-form textarea#body").show();
        } else if ($(newActiveTab).attr('id') == 'post-form-preview-tab') {
            $("#post-preview").show();
        　　ju.core.render_preview();
        }
    }
</script>
</body>
</html>
